<section class="dashboard">

  @if (mode === 'line-create') {

  <!-- ================= LINE METADATA ================= -->
  <mat-form-field appearance="outline" class="dashboard__field">
    <mat-label>Numero linea</mat-label>
    <input
      matInput
      type="number"
      [ngModel]="lineNumber"
      (ngModelChange)="lineNumberChange.emit($event)"
      placeholder="Es. 12" />
  </mat-form-field>

    <mat-form-field appearance="outline" class="dashboard__field">
    <mat-label>Route</mat-label>
    <input
      matInput
      [ngModel]="lineRoute"
      (ngModelChange)="lineRouteChange.emit($event)"
      placeholder="Es. Polo Universitario - Stazione" />
  </mat-form-field>

  <mat-form-field appearance="outline" class="dashboard__field">
    <mat-label>Direzione</mat-label>
    <input
      matInput
      [ngModel]="lineDirection"
      (ngModelChange)="lineDirectionChange.emit($event)"
      placeholder="Es. Stazione" />
  </mat-form-field>

  <mat-divider></mat-divider>

  <!-- ================= STOP SEARCH ================= -->
  <mat-form-field appearance="outline" class="dashboard__field">
    <mat-label>Cerca Stop</mat-label>
    <input
      matInput
      [(ngModel)]="search"
      (ngModelChange)="searchChange.emit($event)"
      placeholder="Es. 12 oppure Stazione" />
  </mat-form-field>

  @if (results.length > 0) {
  <div class="results">
    @for (r of results; track r.id) {
    <button
      mat-stroked-button
      class="results__item"
      (click)="addStop.emit(r.id)">
      #{{ r.id }} — {{ r.name || '(senza nome)' }}
    </button>
    }
  </div>
  }

  <div class="badge">
    Selezionate: <strong>{{ selectedStops.length }}</strong> stop
  </div>

  @if (selectedStops.length === 0) {
  <div class="empty">
    Aggiungi fermate dalla ricerca o cliccando i marker sulla mappa.
  </div>
  } @else {
  <div class="selected">
    @for (s of selectedStops; track s.id; let i = $index) {
    <div class="selected__row">
      <div class="selected__label">
        <strong>{{ i + 1 }}.</strong>
        #{{ s.id }} — {{ s.name || '(senza nome)' }}
      </div>

      <div class="selected__actions">
        <button mat-button (click)="moveUp.emit(i)" [disabled]="i === 0">
          Su
        </button>
        <button mat-button (click)="moveDown.emit(i)" [disabled]="i === selectedStops.length - 1">
          Giù
        </button>
        <button mat-button color="warn" (click)="removeAt.emit(i)">
          Rimuovi
        </button>
      </div>
    </div>
    }
  </div>
  }

  } @else {
  <div class="empty">
    Per ora gestiamo solo la creazione (sequenza + polyline).
  </div>
  }

</section>
