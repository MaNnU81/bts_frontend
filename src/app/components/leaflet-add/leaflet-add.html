<div class="leaflet-add-layout">
  <!-- ================= MAP COLUMN ================= -->
  <div class="map-col">
    <div class="map-toolbar">
      <mat-slide-toggle
        [checked]="showFetchedStops"
        (change)="showFetchedStops = $event.checked; onVisibilityChanged()">
        Stops
      </mat-slide-toggle>

      <mat-slide-toggle
        [checked]="showFetchedLines"
        (change)="showFetchedLines = $event.checked; onVisibilityChanged()">
        Lines
      </mat-slide-toggle>

      @if (loading) {
        <span class="status">Caricamentoâ€¦</span>
      } @else if (error) {
        <span class="status error">{{ error }}</span>
      }
    </div>

    <div id="leafletAddMap" class="map"></div>
  </div>

  <!-- ================= PANEL COLUMN ================= -->
<div class="panel-col">

  <!-- ================= STOP PANEL (sempre visibile) ================= -->
  <section class="dock">
    <header class="dock__header">
      <div class="dock__title">Stop editor</div>

      <span class="dock__spacer"></span>

      <button mat-stroked-button (click)="toggleStopPanel()">
        <mat-icon>{{ openPanel === 'stop' ? 'close' : 'add' }}</mat-icon>
        {{ openPanel === 'stop' ? 'Chiudi' : 'Apri' }}
      </button>
    </header>

    @if (openPanel === 'stop') {
      <div class="dock__content">
        <app-stop-editor-panel-component
          [state]="editorState"
          [pendingCount]="pendingCount"
          (saveAll)="saveAllToDb()"
          (applyDraft)="applyStopToDraft()"
          (deleteCurrent)="markDeleteCurrent()"
          (cancel)="cancelSelection()"
          (restoreCurrent)="restoreCurrentStop()"
          (resetAll)="resetAllDraftChanges()">
        </app-stop-editor-panel-component>
      </div>
    }
  </section>

  <!-- ================= LINE PANEL (sempre visibile) ================= -->
  <section class="dock">
    <header class="dock__header">
      <div class="dock__title">Line editor</div>

      <span class="dock__spacer"></span>

      <button mat-stroked-button (click)="toggleLinePanel()">
        <mat-icon>{{ openPanel === 'line' ? 'close' : 'add' }}</mat-icon>
        {{ openPanel === 'line' ? 'Chiudi' : 'Apri' }}
      </button>
    </header>

    @if (openPanel === 'line') {
      <div class="dock__content">
        <app-line-editor-panel-component
          [mode]="editorMode"
          (close)="toggleLinePanel()"
          (confirmSequence)="editorMode = 'line-edit'"
          (backToCreate)="editorMode = 'line-create'">
        </app-line-editor-panel-component>
      </div>
    }
  </section>

</div>

